[![@coreui coreui](https://img.shields.io/badge/@coreui%20-coreui-lightgrey.svg?style=flat-square)](https://github.com/coreui/coreui)
[![npm package][npm-coreui-badge]][npm-coreui]
[![NPM downloads][npm-coreui-download]][npm-coreui]  
[![@coreui react](https://img.shields.io/badge/@coreui%20-react-lightgrey.svg?style=flat-square)](https://github.com/coreui/react)
[![npm package][npm-coreui-react-badge]][npm-coreui-react]
[![NPM downloads][npm-coreui-react-download]][npm-coreui-react]  
[![npm next][npm-next]][npm]

[npm-coreui]: https://www.npmjs.com/package/@coreui/coreui
[npm-coreui-badge]: https://img.shields.io/npm/v/@coreui/coreui.png?style=flat-square
[npm-coreui-download]: https://img.shields.io/npm/dm/@coreui/coreui.svg?style=flat-square
[npm-coreui-react]: https://www.npmjs.com/package/@coreui/react
[npm-coreui-react-badge]: https://img.shields.io/npm/v/@coreui/react.png?style=flat-square
[npm-coreui-react-download]: https://img.shields.io/npm/dm/@coreui/react.svg?style=flat-square
[npm-next]: https://img.shields.io/npm/v/@coreui/react/next.png?style=flat-square
[npm]: https://www.npmjs.com/package/@coreui/react

[![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg)](http://standardjs.com)
[![Commitizen friendly](https://img.shields.io/badge/commitizen-friendly-brightgreen.svg)](http://commitizen.github.io/cz-cli/)
<a href="https://gitlab.ubiwhere.com/5GZORRO/GUI/-/commits/develop"><img alt="pipeline status" src="https://gitlab.ubiwhere.com/5GZORRO/GUI/badges/develop/pipeline.svg" /></a>
<a href="https://gitlab.ubiwhere.com/5GZORRO/GUI/-/commits/develop"><img alt="coverage report" src="https://gitlab.ubiwhere.com/5GZORRO/GUI/badges/develop/coverage.svg" /></a>

# 5GZORRO

## Description 

> 5GZORRO's Governance and Marketplace Portal.

This repo is mirroring Ubiwhere's private repo. 
A public instance of this GUI can be found at https://5gzorro.netlify.app/.
CI/CD is in place, so this instance will always reflect the `develop` branch (may be updated in the future to reflect only `master`). 

---

### ðŸ›  Stack used
- [Node 14](https://nodejs.org/en/download/package-manager/)
- [React](https://pt-br.reactjs.org/)
- [CoreUI for React](https://coreui.io/react/)
- [TypeScript](https://www.typescriptlang.org/)
- [ReactQuery](https://react-query.tanstack.com/)
- [ReactHooksForm](https://react-hook-form.com/)

## Installation
``` bash
# install app's dependencies
$ yarn install
```

### Basic usage

``` bash
# dev server  with hot reload at http://localhost:3000
$ yarn start
```

Navigate to [http://localhost:3000](http://localhost:3000). The app will automatically reload if you change any of the source files.

### Build

Run `build` to build the project. The build artifacts will be stored in the `build/` directory.

```bash
# build for production with minification
$ yarn build
```

### Deploy to Kubernetes instance

This deploy consists of three separate nginx images, each one with the files for one specific deploy (operator-a, operator-b, operator-c or regulator-a). These images are pushed to Ubiwhere's docker hub repo and they are used by the k8s repo.

In order to deploy to the existing Kubernetes instance, you'll need to connect to the project's VPN.

After that, you will need to:

* Setup kubectl: 

    * Install kubectl (client version should be at least 21.1)
    * BCN testbed
        * Move/copy the platcmpk8sconfig file to the kubectl config (usually the ~/.kube/config file).
            - cp ./deployment/platcmpk8sconfig ~/.kube
            - export KUBECONFIG=~/.kube/platcmpk8sconfig
            - kubectl config use-context platcmp-platcmp-k8s-ctrl1
    * 5tonic testbed
        * Move/copy the k8sconfig-5tonic.yaml file to the kubectl config (usually the ~/.kube/config file).  
        - cp ./deployment/k8sconfig-5tonic.yaml ~/.kube
        - export KUBECONFIG=~/.kube/k8sconfig-5tonic.yaml
     * After this, you should be able to access the cluster. You can test this by running something like `kubectl get pods`, which should return the list of pods running in the cluster.

* Build the environment to deploy:

    * `yarn build:<barcelona|5tonic>:<operatorA|operatorB|operatorC>`
    * the files generated by the build will be available at `/build` folder

* Generate the nginx image containing the frontend files:
    
    * Build the image: 
        ```bash
        $ docker build -f deployment/Dockerfile . --build-arg DEPLOY_DIR=/operator-a/ --build-arg SRC_DIR=build/ --tag=ubiwhere/5gzorro-operator-a-dashboard
        ```
        - The `DEPLOY_DIR` should be either `/operator-a/`, `/operator-b/`, `/operator-c/` or `/regulator-a/`, and is the destination folder where the frontend files will be placed in the nginx image. 
        - The `SRC_DIR` is the local directory containing the frontend build files. 
        - The `image tag` should be either `ubiwhere/5gzorro-operator-a-dashboard`, `ubiwhere/5gzorro-operator-b-dashboard`, `ubiwhere/5gzorro-operator-c-dashboard` or `ubiwhere/5gzorro-regulator-a-dashboard`. For the 5tonic testbed add "5tonic" to the image tag name, example: `ubiwhere/5gzorro-5tonic-operator-b-dashboard`

    * Login to docker hub with an account with privileges to push images under the Ubiwhere organization: 
        ```bash
        $ docker login --username <username>
        ```

    * Push the image to the respective registry:
      ```bash
      $ docker push ubiwhere/5gzorro-operator-a-dashboard
      ```

* Deploy in the barcelona or 5tonic cluster (there probably is a better way of doing this but it works since deleting the existing deployment isn't a problem in this case). The deployment files can be found on the `/deployment` folder. 

    * Delete the previous deploy: `kubectl delete -f deployment/deployment-a.yaml`
    * Create a new deploy: `kubectl create -f deployment/deployment-a.yaml`
        * Note: change the deployment files accordingly. For the 5tonic testbed use the files named `5tonic-deployment-<a|b|c|d>.yaml`.
    * Check if everything is ok. A pod, service and deployment should have been created in the respective namespace, which you can test by running:
        * `kubectl get pods -n domain-operator-a` (should have a pod like `operator-dashboard-a-<random_string>`)
        * `kubectl get services -n domain-operator-a` (should have a service `operator-service-a`)
        * `kubectl get deployments -n domain-operator-a` (should have a deployment `operator-dashboard-a`)
    
  

## What's included

Within the download you'll find the following directories and files, logically grouping common assets and providing both compiled and minified variations. You'll see something like this:

```
CoreUI-React#v3.0.0
â”œâ”€â”€ public/          #static files
â”‚   â”œâ”€â”€ assets/      #assets
â”‚   â””â”€â”€ index.html   #html template
â”‚
â”œâ”€â”€ src/             #project root
â”‚   â”œâ”€â”€ assets/  
â”‚   â”œâ”€â”€ containers/  #container source
â”‚   â”œâ”€â”€ scss/        #user scss/css source
â”‚   â”œâ”€â”€ views/       #views source
â”‚   â”œâ”€â”€ App.js
â”‚   â”œâ”€â”€ App.test.js
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ _nav.js      #sidebar config
â”‚   â”œâ”€â”€ routes.js    #routes config
â”‚   â””â”€â”€ store.js     #app store
â”‚
â””â”€â”€ package.json
```

## Documentation

The documentation for the CoreUI Admin Template is hosted at our website [CoreUI for React](https://coreui.io/react/)
